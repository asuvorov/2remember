{% extends "base.html" %}

{# load seo #}
{% load i18n %}

{% comment %}
    Input Parameters:
        :<request> - Request

        :<form>           - Event Form
        :<aform>          - Address Form
        :<formset_roles>  - Roles Formset
        :<formset_social> - Social Links Formset
{% endcomment %}

{% block title %}{% trans "Event" %} "{{ event.title }}" - {{ block.super }}{% endblock %}

{% block extra_meta %}
    {# get_metadata #}
{% comment %}
    <link rel="image_src" href="{{ event.avatar.url }}" />
    <meta name="description" content="{{ event.description|striptags|truncatechars:300 }}" />
{% endcomment %}
{% endblock %}

{% block extra_style %}
{% endblock %}

{% block extra_script %}
{% endblock %}

{% block breadcrumbs %}
<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb p-3 bg-body-tertiary">
            <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'event-list' %}">{% trans "Events" %}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ event.title }}</li>
        </ol>
    </nav>
</a>
{% endblock %}

{% block header %}
{% comment %}
<div class="container">
{% if is_admin and not event.is_draft %}
    <header class="d-flex justify-content-center pb-3">
        <ul class="nav nav-pills">
            <li class="nav-item">
                <a href="{% url 'event-details' event.slug %}" class="nav-link active" aria-current="page">{% trans "Information" %}</a>
            </li>
            <li class="nav-item">
                <a href="{% url 'event-confirm' event.slug %}" class="nav-link">
                    {% trans "To confirm" %}
                    <span id="waiting-for-confirmation-count" class="badge" style="background-color:#f0ad4e;">{{ event.event_participations.waiting_for_confirmation.count }}</span>&nbsp;
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'event-acknowledge' event.slug %}" class="nav-link">
                    {% trans "To acknowledge" %}
                    <span id="waiting-for-acknowledgment-count" class="badge" style="background-color:#5bc0de;">{{ event.event_participations.waiting_for_acknowledgement.count }}</span>&nbsp;
                </a>
            </li>
        </ul>
    </header>
{% endif %}
</div>
{% endcomment %}
{% endblock %}

{% block content %}
{% endblock %}

{% block extra_content %}
<script type="text/javascript">
    /*************************************************************************/
    /*** Subscribe                                                         ***/
    /*************************************************************************/
    $(".subscribe").click(function (event) {
        element = $(this);

        var event = window.event || event;

        event.preventDefault();

        var event_id = "{{ event.id }}";

        $.post("{% url 'api-organization-subscribe' 0 %}".replace("0", event_id), {
        }).done(function (data) {
            console.log("Success");
            console.log("Data :", data);

            $(element).hide("slow");

            new Noty({
                type:   "info",
                text:   data.message
            }).show();
        }).fail(function (data) {
            console.log("Fail");
            console.log("Data :", data);

            try {
                new Noty({
                    type:   "error",
                    text:   data.responseJSON.message
                }).show();
            } catch (err) {
                new Noty({
                    type:   "error",
                    text:   "Failed to subscribe to the Event."
                }).show();
            };
        });

        return true;
    });

    /*************************************************************************/
    /*** Add Comment                                                       ***/
    /*************************************************************************/
    $(".add-comment").click(function (event) {
        element = $(this);

        var event = window.event || event;

        event.preventDefault();

        var event_id = "{{ event.id }}";

        $("#comment-add-modal-form").find("input[name='event_id']").val(event_id);
        $("#commentAddPopupModal").modal("show");
    })

    /*************************************************************************/
    /*** Delete Comment                                                    ***/
    /*************************************************************************/
{% comment %}
    $(".delete-comment").click(function (event) {
        element = $(this);

        var event = window.event || event;

        event.preventDefault();

        var comment_id = $(this).attr("comment");

        $.ajax({
            url:    "{% url 'api-comment-details' 0 %}".replace("0", comment_id),
            type:   "DELETE"
        }).done(function (data) {
            console.log("Success");
            console.log("Data :", data);

            $(element).parent().parent().hide("slow");

            new Noty({
                type:   "info",
                text:   data.message
            }).show();
        }).fail(function (data) {
            console.log("Fail");
            console.log("Data :", data);

            try {
                new Noty({
                    type:   "error",
                    text:   data.responseJSON.message
                }).show();
            } catch (err) {
                new Noty({
                    type:   "error",
                    text:   "Failed to delete the Comment."
                }).show();
            };
        });

        return true;
    })
{% endcomment %}

    /*************************************************************************/
    /*** Add Complaint                                                     ***/
    /*************************************************************************/
    $(".add-complaint").click(function (event) {
        element = $(this);

        var event = window.event || event;

        event.preventDefault();

        var event_id = "{{ event.id }}";

        $("#complaint-add-modal-form").find("input[name='event_id']").val(event_id);
        $("#complaintAddPopupModal").modal("show");
    })
</script>
{% endblock %}
