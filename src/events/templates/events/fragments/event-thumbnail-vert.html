{% load tz %}
{% load i18n %}
{% load imagekit %}

{% comment %}
    Input Parameters:
        :<event>
        :[participation]
        :[show_org]
        :[event_admin]
{% endcomment %}


<div class="card mb-3 shadow bg-body rounded" category="{{ event.category|default:'' }}">
    <a href="{% url 'event-details' event.slug %}">
    {% if event.preview %}
        {% generateimage "common:medium_fill_wide" source=event.preview -- alt=event.title class='img-fluid rounded-start' %}
    {% else %}
    {% endif %}
    <!-- <img src="..." class="img-fluid rounded-start" alt="..."> -->
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning">
            Private
            <span class="visually-hidden">unread messages</span>
        </span>
    </a>

    <div class="card-body">
        <a href="{% url 'event-details' event.slug %}">
            <h5 class="card-title">
                <div class="category-item">
                    <i class="{{ event.stat_category_icon }}" title="{{ event.stat_category_name }}" category="{{ event.category }}" style="background-color:{{ event.stat_category_color }};"></i>
                </div>

                {{ event.title|truncatechars:50 }}

            {% if event.get_rating_avg > 0 %}
                <div class="" style="color:orange;">
                    <input id="id_event_rating" name="event_rating" type="hidden" class="rating" data-filled="fa fa-star fa-fw" data-empty="fa fa-star-o fa-fw" data-start="0" data-stop="5" data-step="1" disabled="disabled" value="{{ event.get_rating_avg }}" />
                </div>
            {% endif %}
            </h5>
        </a>

        <p class="card-text">{{ event.description|striptags|truncatechars:200 }}</p>
        <p class="card-text">
        {% if event.organization and not event.organization.is_deleted and show_org %}
            {% if event.organization.avatar %}
                {% generateimage "header:thumbnail" source=event.organization.avatar -- alt=event.organization.name %}
            {% endif %}
                <strong>{% trans "by" %}</strong>
                <a href="{% url 'organization-details' event.organization.slug %}"> {{ event.organization.name }}</a> {{ event.created|timesince }} {% trans "ago" %}
        {% endif %}
        </p>
        <p class="card-text">
            <i class="bi bi-pin-map"></i>
        {% if event.addressless %}
            <span class="badge text-bg-warning">{% trans "Location is not provided" %}</span>
        {% else %}
            {{ event.address.short_address }}
        {% endif %}

            <br/>

            <i class="bi bi-calendar-date"></i>
        {% if event.is_dateless %}
            <span class="badge text-bg-warning">{% trans "Dateless" %}</span>
        {% else %}
            {{ event.start_date|date:"M j, Y" }}
        {% endif %}
        </p>

    {% if event.author.profile.avatar %}
        {% generateimage "header:thumbnail" source=event.author.profile.avatar -- alt=event.author.profile.auth_name %}
    {% endif %}
        <a href="{% url 'profile-view' event.author_id %}"> {{ event.author.first_name }}</a>
    </div>

    <div class="card-footer bg-transparent border-success">
        <p class="card-text">
            <small class="text-muted">
                <i class="bi bi-feather"></i> {{ event.get_comments_count }}
                <span class="vert-delimiter">|</span>
                <i class="bi bi-eye"></i> {{ event.get_views_count }}

                <br/>

                {% trans "Last updated" %} {{ event.modified|timesince }} {% trans "ago" %}
            </small>
        </p>
    </div>
</div>



{% comment %}
<div class="event-thumb-container" category="{{ event.category|default:'' }}">
    <div class="event-thumb-vert" style="{% if event.organization.is_hidden %}background-color:#FBEFEF;{% endif %}">
        <div class="event-tags">
        {% if event.tags.all and event.hashtag %}
            <p>
                <i class="fa fa-tags fa-fw"></i>
            {% for tag in event.tags.all %}
                <a href="?tag={{ tag.id }}">{{ tag.name }}</a>
                {% if not forloop.last %}, {% endif %}
            {% endfor %}

                <span class="vert-delimiter">|</span>

                <i class="fa fa-hashtag fa-fw"></i>{{ event.hashtag }}
            </p>
        {% elif event.tags.all %}
            <p>
                <i class="fa fa-tags fa-fw"></i>
            {% for tag in event.tags.all %}
                <a href="?tag={{ tag.id }}">{{ tag.name }}</a>
                {% if not forloop.last %}, {% endif %}
            {% endfor %}
            </p>
        {% elif event.hashtag %}
            <p>
                <i class="fa fa-hashtag fa-fw"></i>{{ event.hashtag }}
            </p>
        {% endif %}
        </div>

        <div class="event-status">
        {% if participation %}
            {% if participation.status == PARTICIPATION_STATUS.CONFIRMED %}
                <p><span class="label label-success">{% trans "Confirmed" %}</span></p>
            {% elif participation.status == PARTICIPATION_STATUS.WAITING_FOR_CONFIRMATION %}
                <p><span class="label label-warning">{% trans "Waiting for Confirmation" %}</span></p>
            {% elif participation.status == PARTICIPATION_STATUS.WAITING_FOR_SELFREFLECTION %}
                <p><span class="label label-warning">{% trans "Waiting for Selfreflection" %}</span></p>
            {% elif participation.status == PARTICIPATION_STATUS.WAITING_FOR_ACKNOWLEDGEMENT %}
                <p><span class="label label-warning">{% trans "Waiting for Acknowledgement" %}</span></p>
            {% elif participation.status == PARTICIPATION_STATUS.ACKNOWLEDGED %}
                <p><span class="label label-success">{% trans "Acknowledged" %}</span></p>
            {% endif %}
        {% endif %}

        {% if event_admin %}
            {% if event.get_confirmed_count > 0 %}
                <p><span class="label label-success">{{ event.get_confirmed_count }} {% trans "Confirmed Application(s)" %}</span></p>
            {% endif %}

            {% if event.has_waiting_for_confirmation %}
                <p><span class="label label-warning">{{ event.get_waiting_for_confirmation_count }} {% trans "Pending Application(s)" %}</span></p>
            {% endif %}

            {% if event.has_waiting_for_acknowledgement %}
                <p><span class="label label-warning">{{ event.get_waiting_for_acknowledgement_count }} {% trans "Pending Experience Reports" %}</span></p>
            {% endif %}

            {% if event.is_overdue and not event.is_complete %}
                <p><span class="label label-danger">{% trans "Mark as completed" %}</span></p>
            {% endif %}
        {% endif %}
        </div>

        <div class="learn-more">
            <a class="btn btn-warning btn-centered" href="{% url 'event-details' event.slug %}" style="width:auto;">{% trans "LEARN MORE" %} <i class="fa fa-chevron-right fa-fw"></i></a>
        </div>
    </div>
</div>
{% endcomment %}
